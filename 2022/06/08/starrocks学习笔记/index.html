<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="baidu-site-verification" content="code-wEyWvQMfX7">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"gujincheng.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"default"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="本文主要包括：  starrocks学习笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="starrocks学习笔记">
<meta property="og:url" content="https://gujincheng.github.io/2022/06/08/starrocks%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="Golden Blog">
<meta property="og:description" content="本文主要包括：  starrocks学习笔记">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-06-08T06:50:31.000Z">
<meta property="article:modified_time" content="2025-08-11T01:58:28.226Z">
<meta property="article:author" content="Golden">
<meta property="article:tag" content="starrocks">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://gujincheng.github.io/2022/06/08/starrocks%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>starrocks学习笔记 | Golden Blog</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?730b9e375674d8f70a08061cd491e24c";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>





  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Golden Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Golden Blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://gujincheng.github.io/2022/06/08/starrocks%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="Golden">
      <meta itemprop="description" content="计划推动变化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Golden Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          starrocks学习笔记
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-06-08 14:50:31" itemprop="dateCreated datePublished" datetime="2022-06-08T14:50:31+08:00">2022-06-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-08-11 09:58:28" itemprop="dateModified" datetime="2025-08-11T09:58:28+08:00">2025-08-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/" itemprop="url" rel="index"><span itemprop="name">大数据</span></a>
                </span>
            </span>

          
            <span id="/2022/06/08/starrocks%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-meta-item leancloud_visitors" data-flag-title="starrocks学习笔记" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/06/08/starrocks%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/06/08/starrocks%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>本文主要包括：</p>
<ul>
<li>starrocks学习笔记</li>
</ul>
<a id="more"></a>





<h2 id="starrocks简介"><a href="#starrocks简介" class="headerlink" title="starrocks简介"></a>starrocks简介</h2><p>starrocks的官网写的很好，也有中文文档，文档可以直接看<a target="_blank" rel="noopener" href="https://docs.starrocks.com/zh-cn/main/introduction/StarRocks_intro">starrocks官网</a></p>
<h3 id="实战经验"><a href="#实战经验" class="headerlink" title="实战经验"></a>实战经验</h3><p>可以参考<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/qvKyBuy_V4_-RrXysDnfow">StarRocks 实战指南：100+ 大型企业背后的最佳实践经验</a></p>
<h2 id="导数据到Starrocks"><a href="#导数据到Starrocks" class="headerlink" title="导数据到Starrocks"></a>导数据到Starrocks</h2><h3 id="从本地文件导数据到Starrocks"><a href="#从本地文件导数据到Starrocks" class="headerlink" title="从本地文件导数据到Starrocks"></a>从本地文件导数据到Starrocks</h3><p>注意，文件格式需要是utf-8，如果有中文乱码，会报错:<br>原始文件为：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">&quot;ECU01&quot;,&quot;ECU02&quot;,&quot;ECU03&quot;,&quot;ECU04&quot;,&quot;ECU05&quot;,&quot;ECU06&quot;,&quot;ECU07&quot;,&quot;ECU08&quot;,&quot;ECU09&quot;,&quot;ECUACTI&quot;,&quot;ECUUSER&quot;,&quot;ECUGRUP&quot;,&quot;ECUMODU&quot;,&quot;ECUDATE&quot;,&quot;ECU10&quot;,&quot;ECU11&quot;,&quot;ECUUD01&quot;,&quot;ECUUD02&quot;,&quot;ECUUD03&quot;,&quot;ECUUD04&quot;,&quot;ECUUD05&quot;,&quot;ECUUD06&quot;,&quot;ECUUD07&quot;,&quot;ECUUD08&quot;,&quot;ECUUD09&quot;,&quot;ECUUD10&quot;,&quot;ECUUD11&quot;,&quot;ECUUD12&quot;,&quot;ECUUD13&quot;,&quot;ECUUD14&quot;,&quot;ECUUD15&quot;,&quot;ECUORIU&quot;,&quot;ECUORIG&quot;,&quot;ECU012&quot;,&quot;ECU014&quot;,&quot;ECU015&quot;
&quot;1101830000001&quot;,&quot;A01&quot;,&quot;10激光切割,20刻字外协,30油压校平,40加工中心&quot;,10,40,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;Y&quot;,&quot;00696&quot;,&quot;3000&quot;,&quot;00696&quot;,2014-10-18 00:00:00,&quot;Y&quot;,,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,,,,,,,,,,&quot;00696&quot;,&quot;3000&quot;,&quot; &quot;,&quot;&quot;,&quot;&quot;
&quot;1101830000002&quot;,&quot;A01&quot;,&quot;10激光切割,20刻字外协,30油压校平&quot;,10,30,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;Y&quot;,&quot;00696&quot;,&quot;3000&quot;,&quot;00696&quot;,2014-10-18 00:00:00,&quot;Y&quot;,,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,,,,,,,,,,&quot;00696&quot;,&quot;3000&quot;,&quot; &quot;,&quot;&quot;,&quot;&quot;
&quot;1101830000004&quot;,&quot;A01&quot;,&quot;10激光切割,20刻字外协,30油压校平&quot;,10,30,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;Y&quot;,&quot;00696&quot;,&quot;3000&quot;,&quot;00696&quot;,2014-10-18 00:00:00,&quot;Y&quot;,,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,,,,,,,,,,&quot;00696&quot;,&quot;3000&quot;,&quot; &quot;,&quot;&quot;,&quot;&quot;
&quot;1101830000005&quot;,&quot;A01&quot;,&quot;10激光切割,20刻字外协,30油压校平&quot;,10,30,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;Y&quot;,&quot;00696&quot;,&quot;3000&quot;,&quot;00696&quot;,2014-10-18 00:00:00,&quot;Y&quot;,,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,,,,,,,,,,&quot;00696&quot;,&quot;3000&quot;,&quot; &quot;,&quot;&quot;,&quot;&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>导入语句：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">iconv -f gbk -t UTF-8 ecu_file.csv -o ecu_file1.csv
sed -i &#39;s&#x2F;\r&#x2F;&#x2F;g&#39; ecu_file1.csv
curl --location-trusted -u root:DiGiWin@123 -H &quot;label:ECU_FILE&quot; \
-H &quot;Expect:100-continue&quot; -H &quot;timeout: 259200&quot; -H &quot;max_filter_ratio: 0.2&quot; \
-H &quot;column_separator: ,&quot; -H &quot;skip_header: 1&quot; -H &quot;enclose: \&quot;&quot; \
-H &quot;columns: ECU01,ECU02,ECU03,ECU04,ECU05,ECU06,ECU07,ECU08,ECU09,ECUACTI,ECUUSER,ECUGRUP,ECUMODU,ECUDATE,ECU10,ECU11,ECUUD01,ECUUD02,ECUUD03,ECUUD04,ECUUD05,ECUUD06,ECUUD07,ECUUD08,ECUUD09,ECUUD10,ECUUD11,ECUUD12,ECUUD13,ECUUD14,ECUUD15,ECUORIU,ECUORIG,ECU012,ECU014,ECU015&quot; \
-T ecu_file1.csv -XPUT http:&#x2F;&#x2F;xxxx:18030&#x2F;api&#x2F;SMESPROD_GJC&#x2F;ECU_FILE&#x2F;_stream_load<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>实际测试，1.4G的数据，在单机情况下，导入时间为：<code>&quot;ReadDataTimeMs&quot;: 14933ms,&quot;WriteDataTimeMs&quot;: 16662ms,</code></p>
<h3 id="从HDFS导数据到StarRocks"><a href="#从HDFS导数据到StarRocks" class="headerlink" title="从HDFS导数据到StarRocks"></a>从HDFS导数据到StarRocks</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- export data to hdfs</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> 
FILES<span class="token punctuation">(</span>
    <span class="token string">"path"</span> <span class="token operator">=</span> <span class="token string">"hdfs://nameservice1/tmp/gujc/export/gjc_test_bigdata_cdc3/"</span><span class="token punctuation">,</span>
    <span class="token string">"format"</span> <span class="token operator">=</span> <span class="token string">"parquet"</span><span class="token punctuation">,</span>
    <span class="token string">"compression"</span> <span class="token operator">=</span> <span class="token string">"lz4"</span><span class="token punctuation">,</span>
    <span class="token string">"target_max_file_size"</span> <span class="token operator">=</span> <span class="token string">"104857600"</span> <span class="token comment">-- 100M</span>
<span class="token punctuation">)</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> test<span class="token punctuation">.</span>gjc_test_bigdata_cdc3 <span class="token punctuation">;</span>

<span class="token comment">-- import data from hdfs</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test<span class="token punctuation">.</span>gjc_test_bigdata_cdc4
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> FILES
<span class="token punctuation">(</span>
    <span class="token string">"path"</span> <span class="token operator">=</span> <span class="token string">"hdfs://nameservice1/tmp/gujc/export/gjc_test_bigdata_cdc3/30269e30-6ead-11f0-b7ba-02426c246744_0_0_0.parquet"</span><span class="token punctuation">,</span>
    <span class="token string">"format"</span> <span class="token operator">=</span> <span class="token string">"parquet"</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="flinkcdc实时写Starrocks"><a href="#flinkcdc实时写Starrocks" class="headerlink" title="flinkcdc实时写Starrocks"></a>flinkcdc实时写Starrocks</h3><p>下载flink-connector-starrocks，可以直接在maven仓库里下载相应的jar包，并把它放在${FLINK_HOME}/lib下，启动flink集群以及sql-client<br>在starrocks里创建表：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"> <span class="token keyword">create</span> <span class="token keyword">table</span> gjc_test_binlog<span class="token punctuation">(</span>
    uuid <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    age <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    ts <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
    part <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> 
 <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>uuid<span class="token punctuation">)</span>
 <span class="token keyword">DISTRIBUTED</span> <span class="token keyword">BY</span> <span class="token keyword">HASH</span><span class="token punctuation">(</span>uuid<span class="token punctuation">)</span> BUCKETS <span class="token number">1</span>
 PROPERTIES<span class="token punctuation">(</span><span class="token string">"replication_num"</span> <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">)</span>
<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>注意：<br>这里需要指定replication_num，系统默认是3，但是当前集群节点只有1个be，否则插入数据会报如下错误：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">Failed to find enough host in all backends. need: 3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>在flink的sql客户端里创建映射表：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">set</span> execution<span class="token punctuation">.</span>checkpointing<span class="token punctuation">.</span><span class="token keyword">interval</span><span class="token operator">=</span><span class="token number">3</span>sec<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> users_source_mysql <span class="token punctuation">(</span>
    uuid <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
    name STRING<span class="token punctuation">,</span>
    age <span class="token keyword">int</span><span class="token punctuation">,</span>
    ts <span class="token keyword">timestamp</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    part string
<span class="token punctuation">)</span> <span class="token keyword">WITH</span> <span class="token punctuation">(</span>
<span class="token string">'connector'</span> <span class="token operator">=</span> <span class="token string">'mysql-cdc'</span><span class="token punctuation">,</span>
<span class="token string">'hostname'</span> <span class="token operator">=</span> <span class="token string">'150.158.190.192'</span><span class="token punctuation">,</span>
<span class="token string">'port'</span> <span class="token operator">=</span> <span class="token string">'3306'</span><span class="token punctuation">,</span>
<span class="token string">'username'</span> <span class="token operator">=</span> <span class="token string">'root'</span><span class="token punctuation">,</span>
<span class="token string">'password'</span> <span class="token operator">=</span> <span class="token string">'Gjc123!@#'</span><span class="token punctuation">,</span>
<span class="token string">'server-time-zone'</span> <span class="token operator">=</span> <span class="token string">'Asia/Shanghai'</span><span class="token punctuation">,</span>
<span class="token string">'debezium.snapshot.mode'</span> <span class="token operator">=</span> <span class="token string">'initial'</span><span class="token punctuation">,</span>
<span class="token string">'database-name'</span> <span class="token operator">=</span> <span class="token string">'test'</span><span class="token punctuation">,</span>
<span class="token string">'table-name'</span> <span class="token operator">=</span> <span class="token string">'users_source_mysql'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> star_gjc_test_binlog <span class="token punctuation">(</span>
  uuid <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">,</span>
  name STRING<span class="token punctuation">,</span>
  age <span class="token keyword">int</span><span class="token punctuation">,</span>
  ts <span class="token keyword">timestamp</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  part string 
<span class="token punctuation">)</span> <span class="token keyword">WITH</span> <span class="token punctuation">(</span>
   <span class="token string">'connector'</span><span class="token operator">=</span><span class="token string">'starrocks'</span><span class="token punctuation">,</span>
   <span class="token string">'jdbc-url'</span><span class="token operator">=</span><span class="token string">'jdbc:mysql://cxxx:19030'</span><span class="token punctuation">,</span>
   <span class="token string">'load-url'</span><span class="token operator">=</span><span class="token string">'xxxx:18030'</span><span class="token punctuation">,</span>
   <span class="token string">'username'</span><span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">,</span>
   <span class="token string">'password'</span><span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>
   <span class="token string">'database-name'</span><span class="token operator">=</span><span class="token string">'test'</span><span class="token punctuation">,</span>
   <span class="token string">'table-name'</span><span class="token operator">=</span><span class="token string">'gjc_test_binlog'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> star_gjc_test_binlog <span class="token keyword">select</span> uuid<span class="token punctuation">,</span>name<span class="token punctuation">,</span>age<span class="token punctuation">,</span>ts<span class="token punctuation">,</span>part <span class="token keyword">from</span> users_source_mysql<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>和clickhouse一样，在导数据之前，需要在starrocks里提前把表创建好，否则会报错</p>
<p>注意：<br> 建表的时候一定要注意字段长度，如果字段长度不够，数据会默认置为空</p>
<h2 id="使用DataStream写Starrocks"><a href="#使用DataStream写Starrocks" class="headerlink" title="使用DataStream写Starrocks"></a>使用DataStream写Starrocks</h2><h3 id="flinkcdc采集多表并sink到starrrocks"><a href="#flinkcdc采集多表并sink到starrrocks" class="headerlink" title="flinkcdc采集多表并sink到starrrocks"></a>flinkcdc采集多表并sink到starrrocks</h3><p>这里在实现多表sink的时候，一开始想要偷懒使用jdbc的方式，自动拼接sql写入starrocks的，但是，会报<code>too many versions</code><br>原因是，starrcoks每次insert into都会生成一个version，然后会定期compaction，在采集的snapshot阶段，由于写入的数据比较大，会导致version过多<br>需要注意的是，使用jdbc的<code>pstmt.executeBatch();</code>也是不行的，数据还是一条一条的insert。<br>starrocks的微批写入，不是使用<code>pstmt.executeBatch();</code>，而是用的<code>stream load</code>方式，下面直接开发<code>stream load</code>方式<br>多个表同步需要利用flink-connector的DataStream api写入starrocks，cdc多表写入到starrocks的思路是source按cdc配置读取多表，mapfunc转化成StarRocksSinkRowDataWithMeta，然后写入到starrocks sink<br>直接上代码：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">runJob</span><span class="token punctuation">(</span><span class="token class-name">CommandArgs</span> commandArgs<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> checkpointPath <span class="token operator">=</span> baseCheckpintPath <span class="token operator">+</span> <span class="token class-name">DigestUtils</span><span class="token punctuation">.</span><span class="token function">md5Hex</span><span class="token punctuation">(</span>commandArgs<span class="token punctuation">.</span><span class="token function">getSchema</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"."</span> <span class="token operator">+</span> commandArgs<span class="token punctuation">.</span><span class="token function">getStbn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Configuration</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置自动获取上次的断点</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"true"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>commandArgs<span class="token punctuation">.</span><span class="token function">getIsFromCK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token class-name">String</span> lastCheckpintPath <span class="token operator">=</span> <span class="token class-name">CheckpointUtil</span><span class="token punctuation">.</span><span class="token function">getCkPath</span><span class="token punctuation">(</span>checkpointPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            LOG<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"&lt;=======  断点续传：自动从 &#123;&#125; 恢复 =======>"</span><span class="token punctuation">,</span>lastCheckpintPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//断点续传，获取最近一次的checkpoint路径，如果路径为空，那么告警并退出</span>
            <span class="token comment">//todo 这里需要检查一下当前flink job的状态是否已完成，如果是running，直接退出</span>
            conf<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token string">"execution.savepoint.path"</span><span class="token punctuation">,</span> lastCheckpintPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">//不断点续传，删除目标表并重新创建目标表</span>
            LOG<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"&lt;=======  非断点续传：删除目标表并重建 =======>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> jdbcUrl <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"jdbc:mysql://%s:%s/%s"</span><span class="token punctuation">,</span>commandArgs<span class="token punctuation">.</span><span class="token function">getThost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>commandArgs<span class="token punctuation">.</span><span class="token function">getTport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>commandArgs<span class="token punctuation">.</span><span class="token function">getTdb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">StarRocksUtil</span> starRocksUtil <span class="token operator">=</span> <span class="token class-name">StarRocksUtil</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StarRocksJdbcConnectionOptions</span><span class="token punctuation">(</span>jdbcUrl<span class="token punctuation">,</span>commandArgs<span class="token punctuation">.</span><span class="token function">getTuser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>commandArgs<span class="token punctuation">.</span><span class="token function">getTpsw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">SqlConstructorUtils</span> sqlConstructorUtils <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlConstructorUtils</span><span class="token punctuation">(</span>commandArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> sqlCreateList <span class="token operator">=</span> sqlConstructorUtils<span class="token punctuation">.</span><span class="token function">getStarrocksCreateSql</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> sqlDropList <span class="token operator">=</span> sqlConstructorUtils<span class="token punctuation">.</span><span class="token function">getStarrocksDropSql</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> sqlCreateList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                LOG<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"&lt;=======  非断点续传：删除目标表 &#123;&#125; =======>"</span><span class="token punctuation">,</span>sqlDropList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                starRocksUtil<span class="token punctuation">.</span><span class="token function">excuteSql</span><span class="token punctuation">(</span>sqlDropList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                LOG<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"&lt;=======  非断点续传：创建目标表 &#123;&#125; =======>"</span><span class="token punctuation">,</span>sqlCreateList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                starRocksUtil<span class="token punctuation">.</span><span class="token function">excuteSql</span><span class="token punctuation">(</span>sqlCreateList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>

        <span class="token punctuation">&#125;</span>
        <span class="token class-name">StreamExecutionEnvironment</span> env <span class="token operator">=</span> <span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">.</span><span class="token function">getExecutionEnvironment</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//配置ck的状态后端</span>
        env<span class="token punctuation">.</span><span class="token function">setStateBackend</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HashMapStateBackend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置系统异常退出或人为 Cancel 掉，不删除checkpoint数据</span>
        env<span class="token punctuation">.</span><span class="token function">getCheckpointConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setExternalizedCheckpointCleanup</span><span class="token punctuation">(</span><span class="token class-name">CheckpointConfig</span><span class="token punctuation">.</span><span class="token class-name">ExternalizedCheckpointCleanup</span><span class="token punctuation">.</span>RETAIN_ON_CANCELLATION<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置checkpoint存储目录</span>
        env<span class="token punctuation">.</span><span class="token function">getCheckpointConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setCheckpointStorage</span><span class="token punctuation">(</span>checkpointPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        env<span class="token punctuation">.</span><span class="token function">enableCheckpointing</span><span class="token punctuation">(</span>checkpointInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置num值来调整任务允许Checkpoint失败的次数。num需要为0或正整数。如果num为0时，则表示不允许存在任何Checkpoint异常或者失败。</span>
        env<span class="token punctuation">.</span><span class="token function">getCheckpointConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setTolerableCheckpointFailureNumber</span><span class="token punctuation">(</span><span class="token number">1000000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//每隔2秒重试一次，一共重启2147483647次</span>
        env<span class="token punctuation">.</span><span class="token function">setRestartStrategy</span><span class="token punctuation">(</span><span class="token class-name">RestartStrategies</span><span class="token punctuation">.</span><span class="token function">failureRateRestart</span><span class="token punctuation">(</span>
                <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// 每个时间间隔的最大故障次数</span>
                <span class="token class-name">Time</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 测量故障率的时间间隔</span>
                <span class="token class-name">Time</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span> <span class="token comment">// 延时</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> dbName <span class="token operator">=</span> commandArgs<span class="token punctuation">.</span><span class="token function">getTdb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> schama <span class="token operator">=</span> commandArgs<span class="token punctuation">.</span><span class="token function">getSchema</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> tableName <span class="token operator">=</span> <span class="token punctuation">(</span>schama  <span class="token operator">+</span> <span class="token string">"."</span> <span class="token operator">+</span> commandArgs<span class="token punctuation">.</span><span class="token function">getStbn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">,</span><span class="token string">","</span> <span class="token operator">+</span> schama  <span class="token operator">+</span> <span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> tableArr <span class="token operator">=</span>tableName<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Properties</span> dbzProperty <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dbzProperty<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"log.mining.strategy"</span><span class="token punctuation">,</span> <span class="token string">"online_catalog"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dbzProperty<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"log.mining.continuous.mine"</span><span class="token punctuation">,</span><span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dbzProperty<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"poll.interval.ms"</span><span class="token punctuation">,</span><span class="token string">"5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dbzProperty<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"database.tablename.case.insensitive"</span><span class="token punctuation">,</span><span class="token string">"false"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dbzProperty<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"log.mining.batch.size.min"</span><span class="token punctuation">,</span><span class="token string">"50"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dbzProperty<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"log.mining.batch.size.default"</span><span class="token punctuation">,</span><span class="token string">"100"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dbzProperty<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"log.mining.batch.size.max"</span><span class="token punctuation">,</span><span class="token string">"10000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dbzProperty<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"log.mining.sleep.time.default.ms"</span><span class="token punctuation">,</span><span class="token string">"10"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dbzProperty<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"log.mining.sleep.time.max.ms"</span><span class="token punctuation">,</span><span class="token string">"200"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dbzProperty<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"log.mining.sleep.time.increment.ms"</span><span class="token punctuation">,</span><span class="token string">"50"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dbzProperty<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"log.mining.view.fetch.size"</span><span class="token punctuation">,</span><span class="token string">"10000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dbzProperty<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"lob.enabled"</span><span class="token punctuation">,</span><span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dbzProperty<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"snapshot.fetch.size"</span><span class="token punctuation">,</span><span class="token string">"8000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dbzProperty<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"snapshot.delay.ms"</span><span class="token punctuation">,</span><span class="token string">"3000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SourceFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> sourceFunction <span class="token operator">=</span> <span class="token class-name">OracleSource</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">hostname</span><span class="token punctuation">(</span>commandArgs<span class="token punctuation">.</span><span class="token function">getShost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">port</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>commandArgs<span class="token punctuation">.</span><span class="token function">getSport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">database</span><span class="token punctuation">(</span>commandArgs<span class="token punctuation">.</span><span class="token function">getSdb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">schemaList</span><span class="token punctuation">(</span>commandArgs<span class="token punctuation">.</span><span class="token function">getSchema</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">tableList</span><span class="token punctuation">(</span>tableArr<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">username</span><span class="token punctuation">(</span>commandArgs<span class="token punctuation">.</span><span class="token function">getSuser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span>commandArgs<span class="token punctuation">.</span><span class="token function">getSpsw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">debeziumProperties</span><span class="token punctuation">(</span>dbzProperty<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">deserializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StarRocksDebeziumDeserializationSchema</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// converts SourceRecord to JSON String</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">StarRocksSinkOptions</span> sinkOptions <span class="token operator">=</span> <span class="token class-name">StarRocksSinkOptions</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withProperty</span><span class="token punctuation">(</span><span class="token string">"jdbc-url"</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"jdbc:mysql://%s:%s"</span><span class="token punctuation">,</span>commandArgs<span class="token punctuation">.</span><span class="token function">getThost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>commandArgs<span class="token punctuation">.</span><span class="token function">getTport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withProperty</span><span class="token punctuation">(</span><span class="token string">"load-url"</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%s:%s"</span><span class="token punctuation">,</span>commandArgs<span class="token punctuation">.</span><span class="token function">getThost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>commandArgs<span class="token punctuation">.</span><span class="token function">getLoadPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withProperty</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span> commandArgs<span class="token punctuation">.</span><span class="token function">getTuser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withProperty</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">,</span> commandArgs<span class="token punctuation">.</span><span class="token function">getTpsw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withProperty</span><span class="token punctuation">(</span><span class="token string">"table-name"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withProperty</span><span class="token punctuation">(</span><span class="token string">"database-name"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withProperty</span><span class="token punctuation">(</span><span class="token string">"sink.properties.format"</span><span class="token punctuation">,</span> <span class="token string">"json"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withProperty</span><span class="token punctuation">(</span><span class="token string">"sink.properties.strip_outer_array"</span><span class="token punctuation">,</span> <span class="token string">"true"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withProperty</span><span class="token punctuation">(</span><span class="token string">"sink.buffer-flush.interval-ms"</span><span class="token punctuation">,</span><span class="token string">"1000"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withProperty</span><span class="token punctuation">(</span><span class="token string">"sink.properties.column_separator"</span><span class="token punctuation">,</span> <span class="token string">"\\x01"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withProperty</span><span class="token punctuation">(</span><span class="token string">"sink.properties.row_delimiter"</span><span class="token punctuation">,</span> <span class="token string">"\\x02"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SinkFunction</span> sinkFunction <span class="token operator">=</span> <span class="token class-name">StarRocksStreamLoadSink</span><span class="token punctuation">.</span><span class="token function">sink</span><span class="token punctuation">(</span>sinkOptions<span class="token punctuation">,</span>commandArgs<span class="token punctuation">.</span><span class="token function">getStbn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        env<span class="token punctuation">.</span><span class="token function">addSource</span><span class="token punctuation">(</span>sourceFunction<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FilterFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">String</span> row<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
                        <span class="token class-name">String</span> operation <span class="token operator">=</span> <span class="token class-name">JSONObject</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"op"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">return</span> <span class="token class-name">Envelope</span><span class="token punctuation">.</span><span class="token class-name">Operation</span><span class="token punctuation">.</span>CREATE<span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>operation<span class="token punctuation">)</span>
                                <span class="token operator">||</span> <span class="token class-name">Envelope</span><span class="token punctuation">.</span><span class="token class-name">Operation</span><span class="token punctuation">.</span>READ<span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>operation<span class="token punctuation">)</span>
                                <span class="token operator">||</span> <span class="token class-name">Envelope</span><span class="token punctuation">.</span><span class="token class-name">Operation</span><span class="token punctuation">.</span>DELETE<span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>operation<span class="token punctuation">)</span>
                                <span class="token operator">||</span> <span class="token class-name">Envelope</span><span class="token punctuation">.</span><span class="token class-name">Operation</span><span class="token punctuation">.</span>UPDATE<span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>operation<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RichFlatMapFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">StarRocksSinkRowDataWithMeta</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">private</span> <span class="token class-name">SimpleDateFormat</span> sdf<span class="token punctuation">;</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token class-name">Configuration</span> parameters<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span>parameters<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        sdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>

                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token class-name">String</span> row<span class="token punctuation">,</span> <span class="token class-name">Collector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">StarRocksSinkRowDataWithMeta</span><span class="token punctuation">></span></span> collector<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
                        <span class="token class-name">JSONObject</span> rowJson <span class="token operator">=</span> <span class="token class-name">JSONObject</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">String</span> operation <span class="token operator">=</span> rowJson<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"op"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">JSONObject</span> afterJson <span class="token operator">=</span> <span class="token class-name">JSONObject</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>rowJson<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"after"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        afterJson<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"update_time"</span><span class="token punctuation">,</span>sdf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">JSONObject</span> beforeJson <span class="token operator">=</span> <span class="token class-name">JSONObject</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>rowJson<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"before"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        beforeJson<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"update_time"</span><span class="token punctuation">,</span>sdf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Envelope</span><span class="token punctuation">.</span><span class="token class-name">Operation</span><span class="token punctuation">.</span>CREATE<span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>operation<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">Envelope</span><span class="token punctuation">.</span><span class="token class-name">Operation</span><span class="token punctuation">.</span>READ<span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>operation<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                            <span class="token class-name">StarRocksSinkRowDataWithMeta</span> rowData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StarRocksSinkRowDataWithMeta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            rowData<span class="token punctuation">.</span><span class="token function">setDatabase</span><span class="token punctuation">(</span>dbName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            rowData<span class="token punctuation">.</span><span class="token function">setTable</span><span class="token punctuation">(</span>rowJson<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"tableName"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            afterJson<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">StarRocksSinkOP</span><span class="token punctuation">.</span>COLUMN_KEY<span class="token punctuation">,</span><span class="token class-name">StarRocksSinkOP</span><span class="token punctuation">.</span>UPSERT<span class="token punctuation">.</span><span class="token function">ordinal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            rowData<span class="token punctuation">.</span><span class="token function">addDataRow</span><span class="token punctuation">(</span>afterJson<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            collector<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>rowData<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Envelope</span><span class="token punctuation">.</span><span class="token class-name">Operation</span><span class="token punctuation">.</span>DELETE<span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>operation<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                            beforeJson<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">StarRocksSinkOP</span><span class="token punctuation">.</span>COLUMN_KEY<span class="token punctuation">,</span><span class="token class-name">StarRocksSinkOP</span><span class="token punctuation">.</span>DELETE<span class="token punctuation">.</span><span class="token function">ordinal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token class-name">StarRocksSinkRowDataWithMeta</span> rowData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StarRocksSinkRowDataWithMeta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            rowData<span class="token punctuation">.</span><span class="token function">setDatabase</span><span class="token punctuation">(</span>dbName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            rowData<span class="token punctuation">.</span><span class="token function">setTable</span><span class="token punctuation">(</span>rowJson<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"tableName"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            rowData<span class="token punctuation">.</span><span class="token function">addDataRow</span><span class="token punctuation">(</span>beforeJson<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            collector<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>rowData<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Envelope</span><span class="token punctuation">.</span><span class="token class-name">Operation</span><span class="token punctuation">.</span>UPDATE<span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>operation<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                            <span class="token class-name">StarRocksSinkRowDataWithMeta</span> beforeRowData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StarRocksSinkRowDataWithMeta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token class-name">StarRocksSinkRowDataWithMeta</span> afterRowData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StarRocksSinkRowDataWithMeta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            beforeRowData<span class="token punctuation">.</span><span class="token function">setDatabase</span><span class="token punctuation">(</span>dbName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            beforeRowData<span class="token punctuation">.</span><span class="token function">setTable</span><span class="token punctuation">(</span>rowJson<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"tableName"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            afterRowData<span class="token punctuation">.</span><span class="token function">setDatabase</span><span class="token punctuation">(</span>dbName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            afterRowData<span class="token punctuation">.</span><span class="token function">setTable</span><span class="token punctuation">(</span>rowJson<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"tableName"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            beforeJson<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">StarRocksSinkOP</span><span class="token punctuation">.</span>COLUMN_KEY<span class="token punctuation">,</span><span class="token class-name">StarRocksSinkOP</span><span class="token punctuation">.</span>DELETE<span class="token punctuation">.</span><span class="token function">ordinal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            beforeRowData<span class="token punctuation">.</span><span class="token function">addDataRow</span><span class="token punctuation">(</span>beforeJson<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            afterJson<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">StarRocksSinkOP</span><span class="token punctuation">.</span>COLUMN_KEY<span class="token punctuation">,</span><span class="token class-name">StarRocksSinkOP</span><span class="token punctuation">.</span>UPSERT<span class="token punctuation">.</span><span class="token function">ordinal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            afterRowData<span class="token punctuation">.</span><span class="token function">addDataRow</span><span class="token punctuation">(</span>afterJson<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            collector<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>beforeRowData<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            collector<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>afterRowData<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addSink</span><span class="token punctuation">(</span>sinkFunction<span class="token punctuation">)</span>
                <span class="token punctuation">;</span>
        env<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">"More Table Collector Snapshot And Binlog"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>因为解析的cdc数据源转化为json了，所以必须要加上如下参数设置：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token punctuation">.</span><span class="token function">withProperty</span><span class="token punctuation">(</span><span class="token string">"sink.properties.format"</span><span class="token punctuation">,</span> <span class="token string">"json"</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">withProperty</span><span class="token punctuation">(</span><span class="token string">"sink.properties.strip_outer_array"</span><span class="token punctuation">,</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="常用运维命令"><a href="#常用运维命令" class="headerlink" title="常用运维命令"></a>常用运维命令</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 查看占用存储</span>
<span class="token comment">-- 查看某个数据库占用存储</span>
<span class="token keyword">show</span> <span class="token keyword">data</span><span class="token punctuation">;</span>
<span class="token comment">-- 查看某个表占用存储</span>
<span class="token keyword">show</span> <span class="token keyword">data</span> <span class="token keyword">from</span> test<span class="token punctuation">.</span>tableName<span class="token punctuation">;</span>

<span class="token comment">-- 查看当前集群的系统变量信息。如不指定修饰符，默认值为 SESSION。</span>
<span class="token keyword">SHOW</span> <span class="token punctuation">[</span> <span class="token keyword">GLOBAL</span> <span class="token operator">|</span> <span class="token keyword">SESSION</span> <span class="token punctuation">]</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">'wait_timeout'</span><span class="token punctuation">;</span>
<span class="token comment">-- 为 StarRocks 设置指定的系统变量或用户自定义变量</span>
<span class="token keyword">SET</span> <span class="token punctuation">[</span> <span class="token keyword">GLOBAL</span> <span class="token operator">|</span> <span class="token keyword">SESSION</span> <span class="token punctuation">]</span> <span class="token operator">&lt;</span>variable_name<span class="token operator">></span> <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">value</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>variable_name<span class="token operator">></span> <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">value</span><span class="token operator">></span><span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">SET</span> time_zone <span class="token operator">=</span> <span class="token string">"Asia/Shanghai"</span><span class="token punctuation">;</span>
<span class="token comment">--同时设置多个全局变量。需要在所有变量名前添加 GLOBAL 关键字</span>
<span class="token keyword">SET</span>
<span class="token keyword">GLOBAL</span> exec_mem_limit <span class="token operator">=</span> <span class="token number">2147483648</span><span class="token punctuation">,</span>
       <span class="token keyword">GLOBAL</span> time_zone <span class="token operator">=</span> <span class="token string">"Asia/Shanghai"</span><span class="token punctuation">;</span>
<span class="token comment">--该语句用于展示当前集群的配置（当前仅支持展示 FE 的配置项）。</span>
ADMIN <span class="token keyword">SHOW</span> FRONTEND CONFIG <span class="token punctuation">[</span><span class="token operator">LIKE</span> <span class="token string">"pattern"</span><span class="token punctuation">]</span>
ADMIN <span class="token keyword">SHOW</span> FRONTEND CONFIG <span class="token operator">LIKE</span> <span class="token string">'%check_java_version%'</span><span class="token punctuation">;</span>
<span class="token comment">-- 设置集群的配置项（当前仅支持设置 FE 的配置项）。</span>
ADMIN <span class="token keyword">SET</span> FRONTEND CONFIG <span class="token punctuation">(</span><span class="token string">"key"</span> <span class="token operator">=</span> <span class="token string">"value"</span><span class="token punctuation">)</span>
<span class="token comment">-- 非分区表修改分桶数</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> user_tag_string <span class="token keyword">DISTRIBUTED</span> <span class="token keyword">BY</span> <span class="token keyword">HASH</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> BUCKETS <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment">-- 分区表修改分桶数</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> test<span class="token punctuation">.</span>T100OracleInvalidObject_sr_duplicate <span class="token keyword">DISTRIBUTED</span> <span class="token keyword">BY</span> RANDOM BUCKETS <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">-- 修改非分区表的副本数</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> test<span class="token punctuation">.</span>user_tag_string <span class="token keyword">SET</span> <span class="token punctuation">(</span><span class="token string">"replication_num"</span> <span class="token operator">=</span> <span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 修改分区表的副本数</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> test<span class="token punctuation">.</span>T100OracleInvalidObject_sr_duplicate <span class="token keyword">MODIFY</span> <span class="token keyword">PARTITION</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">SET</span> <span class="token punctuation">(</span><span class="token string">"replication_num"</span> <span class="token operator">=</span> <span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 修改分区表的默认副本数，这个仅修改之后新增的分区，历史分区不会变。如果执行了上面的，就不需要执行这个了</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> test<span class="token punctuation">.</span>T100OracleInvalidObject_sr_duplicate <span class="token keyword">SET</span> <span class="token punctuation">(</span><span class="token string">"default.replication_num"</span> <span class="token operator">=</span> <span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>具体可以参考<a target="_blank" rel="noopener" href="https://docs.starrocks.io/zh/docs/sql-reference/sql-statements/all-commands/">All commands</a></p>
<h3 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h3><ol>
<li>实时写starrocks不要使用UNIQUE模型，因为UNIQUE模型不能识别delete/update操作</li>
<li>主键模型的主键长度最大是127，这里在使用的时候，把starrcoks的源码改了一下，从128改成512了</li>
</ol>
<h3 id="Starrocks-Streamload-java实现实例"><a href="#Starrocks-Streamload-java实现实例" class="headerlink" title="Starrocks Streamload java实现实例"></a>Starrocks Streamload java实现实例</h3><p>具体可以参考<a target="_blank" rel="noopener" href="https://github.com/StarRocks/demo/blob/master/MiscDemo/stream_load/java/StarRocksStreamLoad.java">streamload</a></p>
<h2 id="Starrocks与传统数据库的区别？"><a href="#Starrocks与传统数据库的区别？" class="headerlink" title="Starrocks与传统数据库的区别？"></a>Starrocks与传统数据库的区别？</h2><p>这里其实就是OLAP与OLTP的区别：</p>
<p>主要强调数据的精确、事务的原子性和并发性，他们可以可以针对一条一条的数据做处理，但是，starrocks这种olap数据库，它更加强调一批一批的数据，反而对那种一条一条处理的场景有些欠缺。<br>starrocks主要用来做olap多维分析，实时数据分析这种，主要是面对分析场景，而sqlserver，oracle这种传统的数据库，可能更加偏向处理业务场景，不是面向分析场景</p>
<h2 id="Starrocks与Clickhouse的对比"><a href="#Starrocks与Clickhouse的对比" class="headerlink" title="Starrocks与Clickhouse的对比"></a>Starrocks与Clickhouse的对比</h2><h3 id="ClickHouse-简介"><a href="#ClickHouse-简介" class="headerlink" title="ClickHouse 简介"></a>ClickHouse 简介</h3><p>ClickHouse 是由俄罗斯的第一大搜索引擎 Yandex 公司开源的列存数据库。令人惊喜的是，ClickHouse 相较于很多商业 MPP 数据库，比如 Vertica，InfiniDB 有着极大的性能提升。除了 Yandex 以外，越来越多的公司开始尝试使用 ClickHouse 等列存数据库。对于一般的分析业务，结构性较强且数据变更不频繁，可以考虑将需要进行关联的表打平成宽表，放入 ClickHouse 中。<br>相比传统的大数据解决方案，ClickHouse 有以下的优点：</p>
<ol>
<li>配置丰富，只依赖与 Zookeeper</li>
<li>线性可扩展性，可以通过添加服务器扩展集群</li>
<li>容错性高，不同分片间采用异步多主复制</li>
<li>单表性能极佳，采用向量计算，支持采样和近似计算等优化手段</li>
<li>功能强大支持多种表引擎</li>
</ol>
<h3 id="StarRocks-简介"><a href="#StarRocks-简介" class="headerlink" title="StarRocks 简介"></a>StarRocks 简介</h3><p>StarRocks 是一款极速全场景 MPP 企业级数据库产品，具备水平在线扩缩容，金融级高可用，兼容 MySQL 协议和 MySQL 生态，提供全面向量化引擎与多种数据源联邦查询等重要特性。StarRocks 致力于在全场景 OLAP 业务上为用户提供统一的解决方案，适用于对性能，实时性，并发能力和灵活性有较高要求的各类应用场景。<br>相比于传统的大数据解决方案，StarRocks 有以下优点：</p>
<ul>
<li>不依赖于大数据生态，同时外表的联邦查询可以兼容大数据生态</li>
<li>提供多种不同的模型，支持不同维度的数据建模</li>
<li>支持在线弹性扩缩容，可以自动负载均衡</li>
<li>支持高并发分析查询</li>
<li>实时性好，支持数据秒级写入</li>
<li>兼容 MySQL 5.7 协议和 MySQL 生态</li>
</ul>
<h3 id="StarRocks-与-ClickHouse-的功能对比"><a href="#StarRocks-与-ClickHouse-的功能对比" class="headerlink" title="StarRocks 与 ClickHouse 的功能对比"></a>StarRocks 与 ClickHouse 的功能对比</h3><p>StarRocks 与 ClickHouse 有很多相似之处，比如说两者都可以提供极致的性能，也都不依赖于 Hadoop 生态，底层存储分片都提供了主主的复制高可用机制。但功能、性能与使用场景上也有差异。ClickHouse 在更适用与大宽表的场景，TP 的数据通过 CDC 工具的，可以考虑在 Flink 中将需要关联的表打平，以大宽表的形式写入 ClickHouse。StarRocks 对于 join 的能力更强，可以建立星型或者雪花模型应对维度数据的变更。</p>
<p>具体可以参考<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/441059030">ClickHouse vs StarRocks 选型对比</a></p>
<h2 id="编译Starrocks"><a href="#编译Starrocks" class="headerlink" title="编译Starrocks"></a>编译Starrocks</h2><h3 id="clone代码"><a href="#clone代码" class="headerlink" title="clone代码"></a>clone代码</h3><pre class="line-numbers language-text" data-language="text"><code class="language-text">git clone https:&#x2F;&#x2F;github.com&#x2F;StarRocks&#x2F;starrocks.git
git checkout 3.2.6<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>在切换代码的时候，会报错：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">Updating files: 100% (3738&#x2F;3738), done.
Note: switching to &#39;3.2.6&#39;.

You are in &#39;detached HEAD&#39; state. You can look around, make experimental
changes and commit them, and you can discard any commits you make in this
state without impacting any branches by switching back to a branch.

If you want to create a new branch to retain commits you create, you may
do so (now or later) by using -c with the switch command. Example:

  git switch -c &lt;new-branch-name&gt;

Or undo this operation with:

  git switch -

Turn off this advice by setting config variable advice.detachedHead to false

HEAD is now at 258533316e [BugFix] Fix routine load deadlock and expr dynamic partition check and subList error (backport #43839)(backport #44163)(backport #44225) (#44255) <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里是因为，Git 完成了切换的过程，但是你当前处于 “detached HEAD” 状态。这意味着你虽然成功切换到了 3.2.6 的提交，但没有处于任何分支上。<br>通常来说，大多数情况下，当你使用 git checkout 切换到一个标签（tag）或提交（commit）时，就会处于这种 “detached HEAD” 状态。这是因为切换到标签或提交并不会创建一个分支，导致了你处于这种临时状态。<br>要解决这里的问题：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">git switch -c digiwin-3.2.6<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="cherry-pick指定的commit代码"><a href="#cherry-pick指定的commit代码" class="headerlink" title="cherry-pick指定的commit代码"></a>cherry-pick指定的commit代码</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 切换到main分支
git checkout main 
# 查看git log，筛选出想要的commit
# git log --grep&#x3D;&quot;Fix incorrect schema id&quot;
# 筛选出commit id为344a8216dbb04e0fef28b4740710d8fca089b2e6
# 切换到digiwin-3.2.6分支
git checkout digiwin-3.2.6
# cherry-pick 该次commit到自己的分支
git cherry-pick 344a8216dbb04e0fef28b4740710d8fca089b2e6
# 把修改后的代码提交到远程仓库
git push origin digiwin-3.2.6<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="使用docker编译starrocks"><a href="#使用docker编译starrocks" class="headerlink" title="使用docker编译starrocks"></a>使用docker编译starrocks</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker run -it -v &#x2F;root&#x2F;gujc&#x2F;.m2:&#x2F;root&#x2F;.m2 \
     -v &#x2F;root&#x2F;gujc&#x2F;starrocks:&#x2F;root&#x2F;starrocks \
     --name 3.2.6 -d starrocks&#x2F;dev-env-centos7:3.2-latest
     
docker exec -it 094cd17c9078 &#x2F;bin&#x2F;bash
cd &#x2F;root&#x2F;starrocks &amp;&amp; .&#x2F;build.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="升级Starrcocks的mysql-server版本"><a href="#升级Starrcocks的mysql-server版本" class="headerlink" title="升级Starrcocks的mysql-server版本"></a>升级Starrcocks的mysql-server版本</h2><p>通过<code>select version()</code>可以查看当前mysql-server的版本为5.1.0，在扫描漏洞的时候，会报错，如果想升级mysql-server，可以通过在fe.conf里添加如下配置：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">mysql_server_version &#x3D; 8.0.25<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>之后重启fe和be。再次使用<code>select version()</code>，此时可以看到，mysql-server版本已经变成8.0.25<br>但是，通过jdbc连接starrocks，执行类似<code>create database;use dbname</code>的sql，都会报错看报错 像是nio字符截取或者序列化的问题，这时候只能重新编译starrocks<br>以starrocks-3.3.1版本为基础，修改<code>fe-core</code>下的<code>com.starrocks.mysql.MysqlHandshakePacket</code>:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//serializer.writeNulTerminateString(Config.mysql_server_version);</span>
serializer<span class="token punctuation">.</span><span class="token function">writeNulTerminateString</span><span class="token punctuation">(</span><span class="token string">"5.1.0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="Starrrocks一个小bug"><a href="#Starrrocks一个小bug" class="headerlink" title="Starrrocks一个小bug"></a>Starrrocks一个小bug</h3><p>starrocks的desc和判断表是否存在是不区分大小写的，但是，select，drop等语句，是区分的。</p>
<h2 id="Starrocks使用规范："><a href="#Starrocks使用规范：" class="headerlink" title="Starrocks使用规范："></a>Starrocks使用规范：</h2><ol>
<li>实时采集只能使用主键模型</li>
<li>数仓尽量避免使用主键模型，如果非要使用带主键的表，可以使用更新模型代替（主键模型的主键是放到内存的，主键模型多了，会占用大量BE的内存）</li>
<li>建议所有表的分桶数都是be个数整倍数，否则数据会不均衡</li>
</ol>
<h2 id="Starrocks监控指南"><a href="#Starrocks监控指南" class="headerlink" title="Starrocks监控指南"></a>Starrocks监控指南</h2><ol>
<li>监控当前集群各种表的个数（主键模型，更新模型，明细模型）</li>
<li>compaction score值的监控，大于800算异常</li>
<li>监控当前集群正在运行的事务数，当事务数大于500，说明写入压力过大，应该减少写入，必要时需要滚动重启BE<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">mysql&gt; show proc &quot;&#x2F;transactions&#x2F;50006&quot;;
+----------+--------+
| State    | Number |
+----------+--------+
| running  | 0      |
| finished | 11951  |
+----------+--------+
mysql&gt; show proc &quot;&#x2F;transactions&#x2F;50006&#x2F;running&quot;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="Starrocks常用运维命令"><a href="#Starrocks常用运维命令" class="headerlink" title="Starrocks常用运维命令"></a>Starrocks常用运维命令</h2></li>
<li>获取metric数据<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">curl -XGET -s http:&#x2F;&#x2F;xxxx:18040&#x2F;metrics | grep &quot;^starrocks_be_.*_mem_bytes\|^starrocks_be_tcmalloc_bytes_in_use&quot;
starrocks_be_bitmap_index_mem_bytes 0
starrocks_be_bloom_filter_index_mem_bytes 0
starrocks_be_chunk_allocator_mem_bytes 8086528
starrocks_be_clone_mem_bytes 0
starrocks_be_column_metadata_mem_bytes 65472
starrocks_be_column_pool_mem_bytes 0
starrocks_be_column_zonemap_index_mem_bytes 22400
starrocks_be_compaction_mem_bytes 0
starrocks_be_consistency_mem_bytes 0
starrocks_be_datacache_mem_bytes 0
starrocks_be_load_mem_bytes 0
starrocks_be_metadata_mem_bytes 1028840
starrocks_be_ordinal_index_mem_bytes 15256
starrocks_be_process_mem_bytes 126387240
starrocks_be_query_mem_bytes 0
starrocks_be_rowset_metadata_mem_bytes 172840
starrocks_be_schema_change_mem_bytes 0
starrocks_be_segment_metadata_mem_bytes 21210
starrocks_be_segment_zonemap_mem_bytes 13880
starrocks_be_short_key_index_mem_bytes 943
starrocks_be_storage_page_cache_mem_bytes 559296
starrocks_be_tablet_metadata_mem_bytes 769318
starrocks_be_tablet_schema_mem_bytes 308302
starrocks_be_update_mem_bytes 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li>管理大查询<br><a target="_blank" rel="noopener" href="https://docs.starrocks.io/zh/docs/administration/management/monitor_manage_big_queries/">管理大查询</a></li>
</ol>
<h2 id="官方好文"><a href="#官方好文" class="headerlink" title="官方好文"></a>官方好文</h2><ol>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/uJwS6B8Q1pw5pH42dPV0ug">腾讯音乐StarRocks存算分离大规模实践</a></li>
</ol>
<h2 id="StarRocks-2-4-Version-Jemalloc-HeapProfile-使用"><a href="#StarRocks-2-4-Version-Jemalloc-HeapProfile-使用" class="headerlink" title="StarRocks 2.4+ Version Jemalloc HeapProfile 使用"></a>StarRocks 2.4+ Version Jemalloc HeapProfile 使用</h2><p>具体可以参考<a target="_blank" rel="noopener" href="https://starrocks.feishu.cn/docx/U67gdxuHgozWVPxzekLcLs6Onid">StarRocks 2.4+ Version Jemalloc HeapProfile 使用 </a></p>
<h2 id="查看starrocks集群的tablet数"><a href="#查看starrocks集群的tablet数" class="headerlink" title="查看starrocks集群的tablet数"></a>查看starrocks集群的tablet数</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">show</span> <span class="token keyword">proc</span> <span class="token string">'/statistic'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>查看具体表有多少tablet数：<br>可以借助sr官方给的starrocks_tablet_tool</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">java -jar starrocks-tablet-tool.jar config.properties demo.csv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="问题记录"><a href="#问题记录" class="headerlink" title="问题记录"></a>问题记录</h2><ol>
<li>starrcoks明细表不支持datatime大于秒精度的删除，比如 delete table aaa where time = ‘2024-12-01 00:00:00 100’</li>
<li>starrocks增加列操作，在3.3.4上是同步操作，在3.2.11上还是异步操作。</li>
</ol>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/starrocks/" rel="tag"># starrocks</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/06/01/clickhouse%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="prev" title="clickhouse学习笔记">
      <i class="fa fa-chevron-left"></i> clickhouse学习笔记
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/06/16/Oracle%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="next" title="Oracle学习笔记">
      Oracle学习笔记 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#starrocks%E7%AE%80%E4%BB%8B"><span class="nav-number">1.</span> <span class="nav-text">starrocks简介</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E6%88%98%E7%BB%8F%E9%AA%8C"><span class="nav-number">1.1.</span> <span class="nav-text">实战经验</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%BC%E6%95%B0%E6%8D%AE%E5%88%B0Starrocks"><span class="nav-number">2.</span> <span class="nav-text">导数据到Starrocks</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%8E%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E5%AF%BC%E6%95%B0%E6%8D%AE%E5%88%B0Starrocks"><span class="nav-number">2.1.</span> <span class="nav-text">从本地文件导数据到Starrocks</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%8EHDFS%E5%AF%BC%E6%95%B0%E6%8D%AE%E5%88%B0StarRocks"><span class="nav-number">2.2.</span> <span class="nav-text">从HDFS导数据到StarRocks</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#flinkcdc%E5%AE%9E%E6%97%B6%E5%86%99Starrocks"><span class="nav-number">2.3.</span> <span class="nav-text">flinkcdc实时写Starrocks</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8DataStream%E5%86%99Starrocks"><span class="nav-number">3.</span> <span class="nav-text">使用DataStream写Starrocks</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#flinkcdc%E9%87%87%E9%9B%86%E5%A4%9A%E8%A1%A8%E5%B9%B6sink%E5%88%B0starrrocks"><span class="nav-number">3.1.</span> <span class="nav-text">flinkcdc采集多表并sink到starrrocks</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E8%BF%90%E7%BB%B4%E5%91%BD%E4%BB%A4"><span class="nav-number">3.2.</span> <span class="nav-text">常用运维命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">3.3.</span> <span class="nav-text">遇到的问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Starrocks-Streamload-java%E5%AE%9E%E7%8E%B0%E5%AE%9E%E4%BE%8B"><span class="nav-number">3.4.</span> <span class="nav-text">Starrocks Streamload java实现实例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Starrocks%E4%B8%8E%E4%BC%A0%E7%BB%9F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="nav-number">4.</span> <span class="nav-text">Starrocks与传统数据库的区别？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Starrocks%E4%B8%8EClickhouse%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="nav-number">5.</span> <span class="nav-text">Starrocks与Clickhouse的对比</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ClickHouse-%E7%AE%80%E4%BB%8B"><span class="nav-number">5.1.</span> <span class="nav-text">ClickHouse 简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#StarRocks-%E7%AE%80%E4%BB%8B"><span class="nav-number">5.2.</span> <span class="nav-text">StarRocks 简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#StarRocks-%E4%B8%8E-ClickHouse-%E7%9A%84%E5%8A%9F%E8%83%BD%E5%AF%B9%E6%AF%94"><span class="nav-number">5.3.</span> <span class="nav-text">StarRocks 与 ClickHouse 的功能对比</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%96%E8%AF%91Starrocks"><span class="nav-number">6.</span> <span class="nav-text">编译Starrocks</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#clone%E4%BB%A3%E7%A0%81"><span class="nav-number">6.1.</span> <span class="nav-text">clone代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cherry-pick%E6%8C%87%E5%AE%9A%E7%9A%84commit%E4%BB%A3%E7%A0%81"><span class="nav-number">6.2.</span> <span class="nav-text">cherry-pick指定的commit代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8docker%E7%BC%96%E8%AF%91starrocks"><span class="nav-number">6.3.</span> <span class="nav-text">使用docker编译starrocks</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%87%E7%BA%A7Starrcocks%E7%9A%84mysql-server%E7%89%88%E6%9C%AC"><span class="nav-number">7.</span> <span class="nav-text">升级Starrcocks的mysql-server版本</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Starrrocks%E4%B8%80%E4%B8%AA%E5%B0%8Fbug"><span class="nav-number">7.1.</span> <span class="nav-text">Starrrocks一个小bug</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Starrocks%E4%BD%BF%E7%94%A8%E8%A7%84%E8%8C%83%EF%BC%9A"><span class="nav-number">8.</span> <span class="nav-text">Starrocks使用规范：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Starrocks%E7%9B%91%E6%8E%A7%E6%8C%87%E5%8D%97"><span class="nav-number">9.</span> <span class="nav-text">Starrocks监控指南</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Starrocks%E5%B8%B8%E7%94%A8%E8%BF%90%E7%BB%B4%E5%91%BD%E4%BB%A4"><span class="nav-number">10.</span> <span class="nav-text">Starrocks常用运维命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%98%E6%96%B9%E5%A5%BD%E6%96%87"><span class="nav-number">11.</span> <span class="nav-text">官方好文</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#StarRocks-2-4-Version-Jemalloc-HeapProfile-%E4%BD%BF%E7%94%A8"><span class="nav-number">12.</span> <span class="nav-text">StarRocks 2.4+ Version Jemalloc HeapProfile 使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8Bstarrocks%E9%9B%86%E7%BE%A4%E7%9A%84tablet%E6%95%B0"><span class="nav-number">13.</span> <span class="nav-text">查看starrocks集群的tablet数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95"><span class="nav-number">14.</span> <span class="nav-text">问题记录</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Golden"
      src="/uploads/avatar.jpg">
  <p class="site-author-name" itemprop="name">Golden</p>
  <div class="site-description" itemprop="description">计划推动变化</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">96</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">68</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">68</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2021 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Golden</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'SkWNsftcFwwI7sR8WGnbm8G0-gzGzoHsz',
      appKey     : 'wHfJCMCqkaxidT5nJyOygkO7',
      placeholder: "Just go go",
      avatar     : 'wavatar',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
